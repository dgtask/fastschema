(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[757],{73421:function(e,t,r){Promise.resolve().then(r.bind(r,67578))},67578:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return S}});var s=r(57437),n=r(76540),a=r(34560),l=r(2265),o=r(47907),i=r(75006),d=r(15e3),c=r(21270),u=r(82670),f=r(33108),m=r(30248);let x=m.z.object({name:m.z.string().trim().min(1,{message:"Role name is required"}),description:m.z.string().optional(),root:m.z.boolean().optional(),permissions:m.z.array(m.z.string()).optional(),$add:m.z.record(m.z.string(),m.z.array(f.gk)).optional(),$clear:m.z.record(m.z.string(),m.z.array(f.gk)).optional()}),p={name:"",description:"",root:!1,permissions:[],$add:{},$clear:{}};var h=r(80244),g=r(82628),j=r(22782),v=r(3549),b=r(86468),N=r(12647),y=r(57654),w=r(27453),z=r(90688),k=r(26739),C=r(82012),R=r(25326),V=r(97081),$=r(33277),_=r(52235),F=r(79134);let Y=e=>{var t,r;let{editingRole:a,onResourcesUpdated:o,onUsersUpdated:c}=e,[u,f]=(0,l.useState)(!1),[m,x]=(0,l.useState)(null!==(t=null==a?void 0:a.permissions)&&void 0!==t?t:[]),{data:p,isLoading:h,error:g}=(0,n.a)({queryKey:["resources"],queryFn:z.jh,retry:!1,refetchOnWindowFocus:!1}),j=e=>{x(e),null==o||o(e)};if(h)return(0,s.jsx)(i.g,{});if(g)return(0,s.jsx)(d.T,{error:g});let v=e=>{let{resources:t}=e,r=t.filter(e=>!m.includes(e.id)),n=!r.length||t.every(e=>e.group);return(0,s.jsxs)(s.Fragment,{children:[r.map(e=>(0,s.jsx)(b,{resource:e},e.id)),!n&&(0,s.jsx)(k.zz,{className:"my-2"})]})},b=e=>{var t;let{resource:r}=e;return(null==r?void 0:null===(t=r.resources)||void 0===t?void 0:t.length)?(0,s.jsx)(v,{resources:r.resources}):(0,s.jsx)(k.di,{value:r.id,onSelect:()=>{j([...m,r.id])},children:(0,V.Qs)(r.id)},r.id)};return(0,s.jsxs)(R.UQ,{type:"multiple",className:"bg-slate-50 rounded-lg border",defaultValue:["permissions"],children:[(0,s.jsxs)(R.Qd,{value:"permissions",className:"border-0",children:[(0,s.jsx)(R.o4,{className:"hover:no-underline px-4",children:"Permissions"}),(0,s.jsx)(R.vF,{className:"pb-2",children:a?(0,s.jsxs)("div",{className:"px-4 pb-4 bg-background border-t",children:[(0,s.jsx)("div",{className:"flex flex-wrap gap-2 pt-4",children:(0,s.jsxs)(C.J2,{open:u,onOpenChange:f,children:[(0,s.jsx)(C.xo,{asChild:!0,children:(0,s.jsx)(y.z,{variant:"outline",className:"w-[150px] justify-start",children:"+ Add permission"})}),(0,s.jsx)(C.yk,{className:"p-0",align:"start",children:(0,s.jsxs)(k.mY,{children:[(0,s.jsx)(k.sZ,{placeholder:"Search for a permission"}),(0,s.jsxs)(k.e8,{children:[(0,s.jsx)(k.rb,{children:"No results found."}),(0,s.jsx)(k.fu,{children:(0,s.jsx)(v,{resources:null!=p?p:[]})})]})]})})]})}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:m.toSorted((e,t)=>e.localeCompare(t)).map(e=>(0,s.jsx)("div",{children:(0,s.jsxs)($.C,{variant:"secondary",className:"text-md font-medium px-3 py-2 select-none",children:[(0,V.Qs)(e),(0,s.jsx)("button",{onClick:()=>{j(m.filter(t=>t!==e))},className:"flex items-center justify-center w-5 h-5 ml-2 rounded-full bg-slate-50 hover:bg-slate-200",children:(0,s.jsx)(_.Z,{className:"w-4 h-4"})})]})},e))})]}):(0,s.jsx)("p",{className:"px-4 py-4",children:"Please save the role before updating permissions."})})]}),(0,s.jsxs)(R.Qd,{value:"users",className:"border-t border-b-0",children:[(0,s.jsx)(R.o4,{className:"hover:no-underline px-4",children:"Users"}),(0,s.jsx)(R.vF,{className:"pb-2",children:(0,s.jsx)("div",{className:"px-4 pb-4 bg-background border-t",children:(0,s.jsx)("div",{className:"flex flex-wrap gap-2 pt-4",children:(0,s.jsx)(F.H,{field:{type:"relation",name:"users",label:"Users",relation:{schema:"user",field:"roles",type:"m2m",owner:!0,optional:!0}},fieldProps:{value:null!==(r=null==a?void 0:a.users)&&void 0!==r?r:[],onChange:c},content:null!=a?a:{}})})})})]})]})},E=e=>{let{editingRole:t}=e,r=(0,o.useRouter)(),n=(0,u.cI)({resolver:(0,c.F)(x),defaultValues:null!=t?t:p,mode:"onChange"}),a=async e=>{try{let s=await (0,z.x$)(e,null==t?void 0:t.id);w.h4.success("Role ".concat(s.name," saved successfully.")),t||r.push("/settings/roles/edit?id=".concat(s.id)),n.reset(s)}catch(e){}};return(0,s.jsx)("div",{children:(0,s.jsx)(h.l0,{...n,children:(0,s.jsxs)("form",{className:"space-y-8",onSubmit:n.handleSubmit(a),children:[(0,s.jsx)(h.Wi,{control:n.control,name:"name",render:e=>{let{field:t}=e;return(0,s.jsxs)(h.xJ,{children:[(0,s.jsx)(h.lX,{className:"flex",children:(0,s.jsx)(g.u,{tip:"This is the name of your role.",icon:!0,children:(0,s.jsx)("span",{className:"mr-1",children:"Name"})})}),(0,s.jsx)(h.NI,{children:(0,s.jsx)(j.I,{...t,autoComplete:"auto",placeholder:"Role name"})}),(0,s.jsx)(h.zG,{})]})}}),(0,s.jsx)(h.Wi,{control:n.control,name:"description",render:e=>{let{field:t}=e;return(0,s.jsxs)(h.xJ,{children:[(0,s.jsx)(h.lX,{className:"flex",children:(0,s.jsx)("span",{className:"mr-1",children:"Description"})}),(0,s.jsx)(h.NI,{children:(0,s.jsx)(v.g,{...t,autoComplete:"auto",placeholder:"Role Description"})}),(0,s.jsx)(h.zG,{})]})}}),(0,s.jsx)(h.Wi,{control:n.control,name:"root",render:e=>{let{field:t}=e;return(0,s.jsx)(h.xJ,{children:(0,s.jsx)(h.NI,{children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(b.r,{checked:t.value,onCheckedChange:t.onChange,name:"root",id:"root","aria-readonly":!0}),(0,s.jsx)(N._,{htmlFor:"root",className:"flex align-middle gap-1",children:(0,s.jsx)(g.u,{tip:"Root roles have full access to all resources.",icon:!0,children:"Is root?"})})]})})})}}),(0,s.jsx)(Y,{editingRole:t,onResourcesUpdated:e=>{n.setValue("permissions",e)},onUsersUpdated:e=>{(null==e?void 0:e.$add)&&n.setValue("$add.users",e.$add),(null==e?void 0:e.$clear)&&n.setValue("$clear.users",e.$clear)}}),(0,s.jsx)(y.z,{type:"submit",children:"Save"})]})})})};function S(){let e=(0,o.useSearchParams)().get("id"),{data:t,isLoading:r,error:c}=(0,n.a)({queryKey:["role",e],queryFn:()=>(0,z.cY)(e),retry:!1,refetchOnWindowFocus:!1});return((0,l.useEffect)(()=>((0,a.D8)({title:(null==t?void 0:t.name)?"Edit role: ".concat(t.name):"Create new role",description:(null==t?void 0:t.name)?"Edit role ".concat(t.name," to change the permissions of your users."):"Create a new role for your users.",breadcrumbs:[{name:"Roles",path:"/settings/roles"},{name:e?"Edit role":"New role",path:"/settings/roles/edit?id="+(null!=e?e:"")}]}),a.D8),[e,t]),r)?(0,s.jsx)(i.g,{}):c?(0,s.jsx)(d.T,{error:c}):(0,s.jsx)(E,{editingRole:t})}},15e3:function(e,t,r){"use strict";r.d(t,{T:function(){return i}});var s=r(57437),n=r(29069),a=r(62985),l=r(95601),o=r.n(l);let i=e=>{var t;let{title:r,description:l,error:i}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o(),{children:(0,s.jsx)("title",{children:null!=r?r:"Error"})}),(0,s.jsxs)(n.bZ,{variant:"destructive",children:[(0,s.jsx)(a.Z,{size:16,className:"mr-2"}),(0,s.jsx)(n.Cd,{children:null!=r?r:"Error"}),(null==i?void 0:i.message)||l&&(0,s.jsx)(n.X,{children:null!==(t=null==i?void 0:i.message)&&void 0!==t?t:l})]})]})}},75006:function(e,t,r){"use strict";r.d(t,{g:function(){return i}});var s=r(57437),n=r(22169),a=r(2252),l=r(95601),o=r.n(l);let i=e=>{let{title:t,description:r,error:l,full:i,className:d}=e;l&&(t="Error",r=l);let c=(0,n.cn)("z-50 bg-slate-100 opacity-75 flex flex-col items-center justify-center rounded-lg",null!=d?d:"",i?"fixed top-0 left-0 right-0 bottom-0 w-full h-screen":"w-full h-full");return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o(),{children:(0,s.jsx)("title",{children:null!=t?t:"Loading..."})}),(0,s.jsxs)("div",{className:c,children:[l?(0,s.jsx)(a.Z,{size:64,color:"#dc2626"}):(0,s.jsx)("div",{className:"loader ease-linear rounded-full border-4 border-t-4 border-gray-100 h-12 w-12 mb-4"}),(0,s.jsx)("h2",{className:"text-center text-black text-xl font-semibold",children:null!=t?t:"Loading..."}),(0,s.jsx)("p",{className:"w-1/3 text-center text-black",children:null!=r?r:"This may take a few seconds, please don't close this page."})]})]})}},82628:function(e,t,r){"use strict";r.d(t,{u:function(){return l}});var s=r(57437),n=r(62677),a=r(77252);let l=e=>{let{children:t,tip:r,icon:l}=e;return r?(0,s.jsxs)(n.u,{children:[(0,s.jsx)(n.aJ,{type:"button",children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[t,l&&(0,s.jsx)(a.Z,{size:14})]})}),(0,s.jsx)(n._v,{sideOffset:10,children:r})]}):(0,s.jsx)(s.Fragment,{children:t})}},25326:function(e,t,r){"use strict";r.d(t,{Qd:function(){return d},UQ:function(){return i},o4:function(){return c},vF:function(){return u}});var s=r(57437),n=r(2265),a=r(95320),l=r(62177),o=r(22169);let i=a.fC,d=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)(a.ck,{ref:t,className:(0,o.cn)("border-b",r),...n})});d.displayName="AccordionItem";let c=n.forwardRef((e,t)=>{let{className:r,children:n,...i}=e;return(0,s.jsx)(a.h4,{className:"flex",children:(0,s.jsxs)(a.xz,{ref:t,className:(0,o.cn)("flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",r),...i,children:[n,(0,s.jsx)(l.v4q,{className:"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200"})]})})});c.displayName=a.xz.displayName;let u=n.forwardRef((e,t)=>{let{className:r,children:n,...l}=e;return(0,s.jsx)(a.VY,{ref:t,className:"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...l,children:(0,s.jsx)("div",{className:(0,o.cn)("pb-4 pt-0",r),children:n})})});u.displayName=a.VY.displayName},29069:function(e,t,r){"use strict";r.d(t,{Cd:function(){return d},X:function(){return c},bZ:function(){return i}});var s=r(57437),n=r(2265),a=r(57742),l=r(22169);let o=(0,a.j)("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),i=n.forwardRef((e,t)=>{let{className:r,variant:n,...a}=e;return(0,s.jsx)("div",{ref:t,role:"alert",className:(0,l.cn)(o({variant:n}),r),...a})});i.displayName="Alert";let d=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("h5",{ref:t,className:(0,l.cn)("mb-1 font-medium leading-none tracking-tight",r),...n})});d.displayName="AlertTitle";let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("text-sm [&_p]:leading-relaxed",r),...n})});c.displayName="AlertDescription"},9208:function(e,t,r){"use strict";r.d(t,{$N:function(){return m},Vq:function(){return i},cZ:function(){return u},fK:function(){return f}});var s=r(57437),n=r(2265),a=r(72936),l=r(62177),o=r(22169);let i=a.fC;a.xz;let d=a.h_;a.x8;let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)(a.aV,{ref:t,className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...n})});c.displayName=a.aV.displayName;let u=n.forwardRef((e,t)=>{let{className:r,children:n,...i}=e;return(0,s.jsxs)(d,{children:[(0,s.jsx)(c,{}),(0,s.jsxs)(a.VY,{ref:t,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...i,children:[n,(0,s.jsxs)(a.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(l.Pxu,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=a.VY.displayName;let f=e=>{let{className:t,...r}=e;return(0,s.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...r})};f.displayName="DialogHeader";let m=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)(a.Dx,{ref:t,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",r),...n})});m.displayName=a.Dx.displayName,n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)(a.dk,{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",r),...n})}).displayName=a.dk.displayName},22782:function(e,t,r){"use strict";r.d(t,{I:function(){return l}});var s=r(57437),n=r(2265),a=r(22169);let l=n.forwardRef((e,t)=>{let{className:r,type:n,...l}=e;return(0,s.jsx)("input",{type:n,className:(0,a.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...l})});l.displayName="Input"},82012:function(e,t,r){"use strict";r.d(t,{J2:function(){return o},xo:function(){return i},yk:function(){return d}});var s=r(57437),n=r(2265),a=r(57427),l=r(22169);let o=a.fC,i=a.xz;a.ee;let d=n.forwardRef((e,t)=>{let{className:r,align:n="center",sideOffset:o=4,...i}=e;return(0,s.jsx)(a.h_,{children:(0,s.jsx)(a.VY,{ref:t,align:n,sideOffset:o,className:(0,l.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...i})})});d.displayName=a.VY.displayName},62677:function(e,t,r){"use strict";r.d(t,{_v:function(){return c},aJ:function(){return d},pn:function(){return o},u:function(){return i}});var s=r(57437),n=r(2265),a=r(38152),l=r(22169);let o=a.zt,i=a.fC,d=a.xz,c=n.forwardRef((e,t)=>{let{className:r,sideOffset:n=4,...o}=e;return(0,s.jsx)(a.VY,{ref:t,sideOffset:n,className:(0,l.cn)("z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...o})});c.displayName=a.VY.displayName},97081:function(e,t,r){"use strict";r.d(t,{Qs:function(){return n},_v:function(){return s},rV:function(){return a}});let s=e=>new Promise(t=>setTimeout(t,e)),n=e=>{let t=e.toLowerCase().split(" ");for(let e=0;e<t.length;e++)t[e]=t[e].charAt(0).toUpperCase()+t[e].substring(1);return t.join(" ")},a=e=>n(e.replace(/[-_]/g," "))},90688:function(e,t,r){"use strict";r.d(t,{Rd:function(){return o},cY:function(){return a},jh:function(){return i},x$:function(){return l},xv:function(){return n}});var s=r(84971);let n=async()=>(0,s.dX)("/role"),a=async e=>{var t;if(!e)return null;let r=await (0,s.dX)("/role/".concat(e));return r.permissions=(null!==(t=r.permissions)&&void 0!==t?t:[]).map(e=>e.resource),r},l=async(e,t)=>(t||(delete e.$add,delete e.$clear),t?await (0,s.qb)("/role/".concat(t),e):await (0,s.SO)("/role",e)),o=e=>(0,s.HG)("/role/".concat(e)),i=async()=>c(d(await (0,s.dX)("/role/resources"))),d=e=>e.filter(e=>{var t;return!e.whitelist&&((null==e?void 0:null===(t=e.resources)||void 0===t?void 0:t.length)&&(e.resources=d(e.resources)),!0)}),c=e=>e.filter(e=>{var t,r;return(!e.group||null!=e&&null!==(t=e.resources)&&void 0!==t&&!!t.length)&&((null==e?void 0:null===(r=e.resources)||void 0===r?void 0:r.length)&&(e.resources=c(e.resources)),!0)})}},function(e){e.O(0,[310,637,792,872,571,32,732,152,160,147,583,564,271,971,69,744],function(){return e(e.s=73421)}),_N_E=e.O()}]);